(function($){var SearchLight=function(input,url,options){settings=$.extend({minimumCharacters:3,searchDelay:100,limitPerCategory:5,actionFunction:null,align:'left',width:'300',showIcons:true,showEffect:'scroll',hideEffect:'fade'},options);this._settings=settings;var input=$(input);var container=$(document.createElement('div'));container.attr('class','searchlight-balloon');container.css({position:'absolute',zIndex:'1005',top:$('#searchBox .search-form').outerHeight(true),display:'none'});if(settings.width=='auto'){container.css('width',input.outerWidth());}
if(settings.align=='left'){container.css('left','15px');}else if(settings.align=='right'){container.css('right',$('#searchBox').innerWidth()-(input.offset().left+input.outerWidth()));}
var results=$(document.createElement('div'));results.attr('class','searchlight-results-wrapper');results.css({height:'100%'});container.append(results);$('#searchBox form').append(container);this._input=input;this._container=container;this._searchURL=url;this._resultsContainer=results;input.bind('focus.searchlight',{searchlight:this},function(evt){var searchlight=evt.data.searchlight;if(this.value.length>=settings.minimumCharacters){searchlight.search(this.value);}});$('#searchBox').bind('mousedown.searchlight',{searchlight:this},function(evt){var searchlight=evt.data.searchlight;var node=evt.target;var c=0
while(node){if(node==searchlight._input[0]||node==searchlight._container[0]){return;}
node=node.parentNode;}
searchlight.hide();});input.bind('keydown.searchlight',{searchlight:this},function(evt){var searchlight=evt.data.searchlight;if(evt.which==38&&searchlight._selectedRow>0){searchlight.selectRow(searchlight._selectedRow-1);}else if(evt.which==40&&searchlight._selectedRow<searchlight._rowCount-1){searchlight.selectRow(searchlight._selectedRow+1);}else if(evt.which==13&&searchlight._selectedRow>-1){searchlight.activateRow(searchlight._selectedRow);}
if(evt.which==38||evt.which==40){evt.preventDefault();}});input.bind('keyup.searchlight',{searchlight:this},function(evt){var searchlight=evt.data.searchlight;if(searchlight._searchDelayTimer){clearTimeout(searchlight._searchDelayTimer);}
searchlight._searchDelayTimer=setTimeout(function(){var input=searchlight._input[0];if(input.value==searchlight._previousQuery){}else if(input.value.length>=settings.minimumCharacters){searchlight.search(input.value);}else{searchlight.hide();}},settings.searchDelay);});input.bind('keypress.searchlight',{searchlight:this},function(evt){var searchlight=evt.data.searchlight;});this._container.bind('mouseleave.searchlight',{searchlight:this},function(evt){var searchlight=evt.data.searchlight;searchlight.selectRow(-1);});this.resultAction=settings.actionFunction?settings.actionFunction:this.defaultResultAction;};SearchLight.prototype.show=function(){if(!this._container.is(':visible')){this._container.fadeIn('fast');}};SearchLight.prototype.hide=function(){if(this._disableHide){return;}
this._container.fadeOut('fast');};SearchLight.prototype.search=function(query){var searchlight=this;this._previousQuery=query;if(this._previousXHR){this._previousXHR.abort();}
this._previousXHR=$.getJSON(this._searchURL,{q:query},function(results){searchlight.clearResults();for(var i=0;i<results.length;i++){var r=results[i]
if(r.results.length>0){searchlight.addResultCategory(r.title,r.results);}}
searchlight.show();});};SearchLight.prototype.clearResults=function(){this._categoryCount=0;this._rowCount=0;this._selectedRow=-1;this._resultsContainer.html('<table class="searchlight-results"><tr class="quick-search-empty"><td><div class="alert alert-warning text-center"><span>0 Records Found.</span><br/>Please try a different Search (enter 3 or more characters).<\/div></td></tr><\/table>');};SearchLight.prototype.addResultCategory=function(name,results){var first=true;for(var i=0;i<results.length;i++){var r=results[i];var tr=document.createElement('tr');$(tr).attr('class','searchlight-not-selected');var td=document.createElement('td');$(td).html('<span class="searchlight-result-text"></span>');var td_d=td.firstChild;if(this._settings.showIcons){var img=document.createElement('img');img.className='searchlight-result-icon';img.style.width='50px';img.src=r[2]?r[2]:'assets/templates/common-html5/images/spacer.gif';$(td_d).append(img);}
$(td_d).append(r[1]);$(td_d).append("<br><span align=right class=search-price>"+r[3]+"</span><br><div class='star-rating'><div class='star"+r[4]+"'><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i></div></div>");$(tr).append(td);$(tr).bind('mousemove',{searchlight:this},function(evt){var searchlight=evt.data.searchlight;searchlight.selectRow(this._rowId);});$(tr).bind('click',{searchlight:this},function(evt){var searchlight=evt.data.searchlight;searchlight.activateRow(this._rowId);});tr._rowId=this._rowCount;tr._actionValue=r[0];this._resultsContainer.children('table').find('tr.quick-search-empty').before(tr);this._rowCount++;}
var tr=document.createElement('tr');var td=document.createElement('td');tr.className='searchlight-spacer-row';$(tr).append(td);this._resultsContainer.children('table').append(tr);this._categoryCount++;};SearchLight.prototype.selectRow=function(id){this._selectedRow=id;this._resultsContainer.find('tr:not(.searchlight-spacer-row)').each(function(i){if(this._rowId==id){if(!$(this).hasClass('searchlight-selected')){$(this).removeClass('searchlight-not-selected');$(this).addClass('searchlight-selected');}}else{if(!$(this).hasClass('searchlight-not-selected')){$(this).removeClass('searchlight-selected');$(this).addClass('searchlight-not-selected');}}});};SearchLight.prototype.activateRow=function(id){this.resultAction(this._resultsContainer.find('tr:not(.searchlight-spacer-row):eq('+id+')')[0]._actionValue);}
SearchLight.prototype.defaultResultAction=function(val){window.location.href=val;};$.fn.searchlight=function(url,options){this.each(function(){new SearchLight(this,url,options);});};})(jQuery);